<div class="history-container">

  <!-- Loading -->
  <div class="loading-section" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading booking history...</p>
  </div>

  <!-- Main Content -->
  <div class="main-content" *ngIf="!loading">

    <!-- ================= Layout Information ================= -->
    <div class="section-card" *ngIf="plot || layout">
      <div class="section-header">
        <h2><i class="fas fa-building"></i> Layout Information</h2>
      </div>

      <div class="section-content">
        <div class="info-grid">

          <!-- Basic Details -->
          <div class="info-column">
            <h3>Basic Details</h3>
            <div class="info-item">
              <label>Layout Name</label>
              <span>{{ plot?.layout?.layoutName || layout?.layoutName }}</span>
            </div>
          </div>

          <!-- Location Details -->
          <div class="info-column">
            <h3>Location Details</h3>
            <div class="info-item">
              <label>Location</label>
              <span>{{ plot?.layout?.location || layout?.location }}</span>
            </div>
            <div class="info-item">
              <label>Phone</label>
              <span>{{ plot?.layout?.phone || layout?.phone }}</span>
            </div>
          </div>

          <!-- Owners -->
          <div class="info-column">
            <h3>Layout Owners</h3>
            <div class="owners-list">

              <ng-container
                *ngFor="let o of [
                  plot?.layout?.ownerName1 || layout?.ownerName1,
                  plot?.layout?.ownerName2 || layout?.ownerName2,
                  plot?.layout?.ownerName3 || layout?.ownerName3,
                  plot?.layout?.ownerName4 || layout?.ownerName4,
                  plot?.layout?.ownerName5 || layout?.ownerName5,
                  plot?.layout?.ownerName6 || layout?.ownerName6
                ]; let i = index">

                <div class="owner-item" *ngIf="o">
                  <span class="owner-label">Owner {{ i + 1 }}</span>
                  <span>{{ o }}</span>
                </div>

              </ng-container>

            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- ================= Plot Information ================= -->
    <div class="section-card" *ngIf="historyType === 'plot' && plot">
      <div class="section-header">
        <h2><i class="fas fa-map-marker-alt"></i> Plot Information</h2>
      </div>

      <div class="section-content">
        <div class="info-grid">

          <div class="info-column">
            <h3>Plot Details</h3>
            <div class="info-item">
              <label>Plot No</label>
              <span>{{ plot.plotNo }}</span>
            </div>
            <div class="info-item">
              <label>Price</label>
              <span class="price">₹{{ plot.price | number }}</span>
            </div>
          </div>

          <div class="info-column">
            <h3>Plot Owner</h3>
            <div class="info-item">
              <label>Name</label>
              <span>{{ plot.ownerName }}</span>
            </div>
            <div class="info-item">
              <label>Email</label>
              <span>{{ plot.email }}</span>
            </div>
            <div class="info-item">
              <label>Mobile</label>
              <span>{{ plot.mobile }}</span>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- ================= Booking History ================= -->
    <div class="section-card" *ngIf="bookingHistory.length">
      <div class="section-header">
        <h2><i class="fas fa-list-alt"></i> Booking History</h2>
      </div>

      <div class="section-content">
        <div class="booking-timeline">

          <div
            class="booking-card"
            *ngFor="let booking of bookingHistory; let i = index"
            [class.current-booking]="i === 0 && booking.isActive">

            <div class="booking-header">
              <div class="booking-title">
                <h3>
                  Booking #{{ booking.bookingId }}
                  <span class="current-badge" *ngIf="i === 0 && booking.isActive">
                    CURRENT
                  </span>
                </h3>
                <span
                  class="status-badge"
                  [ngClass]="getStatusClass(booking.bookingStatus)">
                  {{ booking.bookingStatus }}
                </span>
              </div>
            </div>

            <div class="booking-content">
              <div class="booking-info-grid">

                <div class="info-section">
                  <h4>Customer Details</h4>
                  <div class="info-item">
                    <label>Name</label>
                    <span>{{ booking.customer?.firstName }}</span>
                  </div>
                  <div class="info-item">
                    <label>Mobile</label>
                    <span>{{ booking.customer?.mobileNo }}</span>
                  </div>
                </div>

                <div class="info-section">
                  <h4>Financial Details</h4>
                  <div class="financial-summary">
                    <div class="financial-item total">
                      ₹{{ booking.price | number }}<span>Total</span>
                    </div>
                    <div class="financial-item paid">
                      ₹{{ getTotalPaid(booking) | number }}<span>Paid</span>
                    </div>
                    <div class="financial-item balance">
                      ₹{{ getBalance(booking) | number }}<span>Balance</span>
                    </div>
                  </div>
                </div>

              </div>
            </div>

            <div class="booking-actions">
              <button
                class="btn btn-primary"
                (click)="rebookPlot(booking)"
                [disabled]="!canRebook(booking)">
                Rebook Plot
              </button>
            </div>

          </div>
        </div>
      </div>
    </div>

    <!-- No Records -->
    <div class="no-records" *ngIf="!bookingHistory.length">
      <i class="fas fa-inbox"></i>
      <h3>No Booking History Found</h3>
    </div>

  </div>

  <div class="footer-actions">
    <button class="btn btn-secondary" (click)="goBack()">Back</button>
    <button class="btn btn-primary" (click)="goHome()">Dashboard</button>
  </div>

</div>
