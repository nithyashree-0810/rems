<div class="form-container" *ngIf="!loading; else loadingTpl">
  <h2 class="form-title">Edit Booking</h2>

  <form [formGroup]="bookingForm" (ngSubmit)="saveBooking()">

    <!-- READ ONLY DETAILS -->
    <div class="row">
      <label class="label">Layout Name:</label>
      <input class="value" formControlName="layoutName" readonly />
    </div>

    <div class="row">
      <label class="label">Plot No:</label>
      <input class="value" formControlName="plotNo" readonly />
    </div>

    <div class="row">
      <label class="label">Customer Name:</label>
      <input class="value" formControlName="customerName" readonly />
    </div>

    <div class="row">
      <label class="label">Mobile No:</label>
      <input class="value" formControlName="mobileNo" readonly />
    </div>

    <div class="row">
      <label class="label">Sqft:</label>
      <input type="number" class="value" formControlName="sqft" readonly />
    </div>

    <div class="row">
      <label class="label">Price:</label>
      <input type="number" class="value" formControlName="price" readonly />
    </div>

    <!-- ================= ADVANCE 1 ================= -->
    <div class="row">
      <label class="label">Advance 1:</label>
      <input type="number"
             class="value"
             formControlName="advance1"
             [readonly]="!canEditAdvance1"
             (input)="calculateBalance()" />
    </div>

    <div *ngIf="bookingForm.value.advance1 > 0">
      <div class="row">
        <label class="label">Advance 1 Date:</label>
        <input type="date" class="value" formControlName="advance1Date" />
      </div>

      <div class="row">
        <label class="label">Advance 1 Mode:</label>
        <select class="value" formControlName="advance1Mode">
          <option value="">-- Select Mode --</option>
          <option>Cash</option>
          <option>UPI</option>
          <option>Bank Transfer</option>
          <option>Cheque</option>
        </select>
      </div>
    </div>

    <!-- ================= ADVANCE 2 ================= -->
    <div class="row">
      <label class="label">Advance 2:</label>
      <input type="number"
             class="value"
             formControlName="advance2"
             [readonly]="!canEditAdvance2"
             (input)="calculateBalance()" />
    </div>

    <div *ngIf="bookingForm.value.advance2 > 0">
      <div class="row">
        <label class="label">Advance 2 Date:</label>
        <input type="date" class="value" formControlName="advance2Date" />
      </div>

      <div class="row">
        <label class="label">Advance 2 Mode:</label>
        <select class="value" formControlName="advance2Mode">
          <option value="">-- Select Mode --</option>
          <option>Cash</option>
          <option>UPI</option>
          <option>Bank Transfer</option>
          <option>Cheque</option>
        </select>
      </div>
    </div>

    <!-- ================= ADVANCE 3 ================= -->
    <div class="row">
      <label class="label">Advance 3:</label>
      <input type="number"
             class="value"
             formControlName="advance3"
             [readonly]="!canEditAdvance3"
             (input)="calculateBalance()" />
    </div>

    <div *ngIf="bookingForm.value.advance3 > 0">
      <div class="row">
        <label class="label">Advance 3 Date:</label>
        <input type="date" class="value" formControlName="advance3Date" />
      </div>

      <div class="row">
        <label class="label">Advance 3 Mode:</label>
        <select class="value" formControlName="advance3Mode">
          <option value="">-- Select Mode --</option>
          <option>Cash</option>
          <option>UPI</option>
          <option>Bank Transfer</option>
          <option>Cheque</option>
        </select>
      </div>
    </div>

    <!-- ================= ADVANCE 4 ================= -->
    <div class="row">
      <label class="label">Advance 4:</label>
      <input type="number"
             class="value"
             formControlName="advance4"
             [readonly]="!canEditAdvance4"
             (input)="calculateBalance()" />
    </div>

    <div *ngIf="bookingForm.value.advance4 > 0">
      <div class="row">
        <label class="label">Advance 4 Date:</label>
        <input type="date" class="value" formControlName="advance4Date" />
      </div>

      <div class="row">
        <label class="label">Advance 4 Mode:</label>
        <select class="value" formControlName="advance4Mode">
          <option value="">-- Select Mode --</option>
          <option>Cash</option>
          <option>UPI</option>
          <option>Bank Transfer</option>
          <option>Cheque</option>
        </select>
      </div>
    </div>

    <!-- BALANCE -->
    <div class="row">
      <label class="label">Balance:</label>
      <input type="number" class="value" formControlName="balance" readonly />
    </div>

    <!-- STATUS -->
    <div class="row">
      <label class="label">Status:</label>
      <select class="value" formControlName="status" (change)="onStatusChange()">
        <option value="">-- Select --</option>
        <option value="Registered">Registered</option>
        <option value="Unregistered">Unregistered</option>
        <option value="Cancel">Cancel</option>
      </select>
    </div>

    <!-- REG DETAILS -->
    <div *ngIf="showRegFields">
      <div class="row">
        <label class="label">Reg Date:</label>
        <input type="date" class="value" formControlName="regDate" />
      </div>

      <div class="row">
        <label class="label">Reg No:</label>
        <input type="number" class="value" formControlName="regNo" />
      </div>
    </div>

    <!-- CANCEL DETAILS -->
    <div *ngIf="showCancelFields">
      <div class="row">
        <label class="label">Refund Amount:</label>
        <input type="number" class="value" formControlName="refundAmount" />
      </div>

      <div class="row">
        <label class="label">Refund Mode:</label>
        <select class="value" formControlName="refundMode">
          <option value="">-- Select Mode --</option>
          <option>Cash</option>
          <option>UPI</option>
          <option>Bank Transfer</option>
          <option>Cheque</option>
        </select>
      </div>
    </div>

    <div class="actions">
      <button type="submit" class="save-btn">Save</button>
      <button type="button" class="home-btn" (click)="goBack()">Cancel</button>
    </div>

  </form>
</div>

<ng-template #loadingTpl>
  <div class="loading">Loading booking details...</div>
</ng-template>
