<div class="container">

  <!-- TITLE ONLY (NO HOME HERE) -->
  <h2>Booking History</h2>

  <!-- SEARCH + CREATE ROW -->
  <div class="search-create-row">

    <!-- SEARCH (CENTER) -->
    <div class="search-container">
      <input type="text" [(ngModel)]="searchLayoutName" (keyup)="onSearch()" placeholder="Search Layout Name"
        class="search-input">

      <input type="text" [(ngModel)]="searchPlotNo" (keyup)="onSearch()" placeholder="Search Plot No"
        class="search-input">

      <button class="search-btn" (click)="onSearch()">Search</button>
    </div>

    <!-- CREATE (RIGHT) -->
    <div class="top-buttons">
      <button class="btn btn-success" (click)="goToCreate()">
        <i class="fa fa-plus"></i> New Booking
      </button>
    </div>

  </div>

  <!-- LOADING -->
  <div *ngIf="loading" class="loading">Loading bookings...</div>

  <!-- TABLE -->
  <div class="table-wrapper" *ngIf="!loading">
    <table class="layout-table">

      <thead>
        <tr>
          <th>ID</th>
          <th>Layout Name</th>
          <th>Plot No</th>
          <th>Customer</th>
          <th>Mobile</th>
          <th>Sqft</th>
          <th>Price</th>
          <th>Advances</th>
          <th>Paid</th>
          <th>Balance</th>
          <th>Direction</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody *ngIf="filteredData.length > 0">
        <tr *ngFor="let b of filteredData | slice:(currentPage-1)*pageSize:currentPage*pageSize">
          <td>{{ b.bookingId }}</td>
          <td class="left-align">{{ b.layout?.layoutName }}</td>
          <td>{{ b.plot?.plotNo }}</td>
          <td class="left-align">{{ b.customer?.firstName }}</td>
          <td>{{ b.customer?.mobileNo }}</td>
          <td>{{ b.sqft }}</td>
          <td>{{ b.price | currency:'INR' }}</td>
          <td class="left-align advances-cell">
            <div *ngFor="let adv of getFormattedAdvances(b)">
              {{ adv }}
            </div>
            <span *ngIf="getFormattedAdvances(b).length === 0">-</span>
          </td>
          <td>{{ getTotalPaid(b) | currency:'INR' }}</td>
          <td>{{ getBalance(b) | currency:'INR' }}</td>
          <td>{{ b.direction }}</td>
          <td>{{ b.status }}</td>

          <!-- ACTION ICONS -->
          <td>
            <div class="action-icons">
              <!-- View -->
              <i class="fa fa-eye circle-icon view" [routerLink]="['/view-booking', b.bookingId]"
                title="View Details"></i>

              <!-- Edit -->
              <i class="fa fa-pencil circle-icon edit" [routerLink]="['/edit-booking', b.bookingId]"
                title="Edit Booking"></i>

              <!-- History -->
              <button class="btn btn-history" (click)="viewHistory(b)"
                title="View complete booking history for this plot">
                <i class="fa fa-clock-rotate-left"></i> History
              </button>

              <!-- Delete -->
              <button class="btn btn-delete" (click)="deleteBooking(b)" title="Cancel Booking">
                <i class="fa fa-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>

      <tbody *ngIf="filteredData.length === 0">
        <tr>
          <td colspan="13" class="no-records-cell">
            <div class="no-records-msg">
              <i class="fa fa-info-circle"></i> No Records Found
            </div>
          </td>
        </tr>
      </tbody>

    </table>

    <app-pagination *ngIf="filteredData.length > 5" [totalItems]="filteredData.length" [pageSize]="pageSize"
      [currentPage]="currentPage" (pageChange)="currentPage = $event"
      (pageSizeChange)="pageSize = $event; currentPage = 1">
    </app-pagination>
  </div>

  <div class="pagination-container">
    <button class="btn btn-danger pagination-home-btn" (click)="goHome()">
      Home
    </button>
  </div>



</div>